---
layout: default
title: TICKET
permalink: /ticket.html
---

<div class="content-section">
  <h1 class="section-title">TICKET</h1>

  <form id="filter-form" class="filter-form">
    <div class="form-group">
      <label>期間:</label>
      <input type="date" id="start-date">
      <span>～</span>
      <input type="date" id="end-date">
    </div>
    <div class="form-group">
      <label for="prefecture">都道府県:</label>
      <select id="prefecture">
        <option value="">すべて</option>
        <option value="東京都">東京都</option>
        <option value="大阪府">大阪府</option>
        <option value="福岡県">福岡県</option>
      </select>
    </div>
    <div class="form-group">
      <label for="artist">出演者:</label>
      <input type="text" id="artist" placeholder="ゲスト名で検索">
    </div>
    <div class="form-buttons">
      <button type="submit">この条件で絞り込む</button>
      <button type="reset" id="reset-button">リセット</button>
    </div>
  </form>

  <div id="ticket-list-container" class="ticket-list">
    {% for ticket in site.data.tickets %}
      <div class="ticket-item animate-on-scroll" 
           data-date="{{ ticket.date }}" 
           data-prefecture="{{ ticket.prefecture }}" 
           data-artists="{{ ticket.artists | join: ',' }}">
        <h3>{{ ticket.title }}</h3>
        <p>日時: {{ ticket.datetime_str }}</p>
        <p>会場: {{ ticket.place }} ({{ ticket.prefecture }})</p>
        <p>他の出演者: {% if ticket.artists.size > 0 %}{{ ticket.artists | join: ', ' }}{% else %}なし{% endif %}</p>
        <a href="{{ ticket.url }}" class="ticket-button">詳細を見る</a>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  // --- 要素の取得 ---
  const filterForm = document.getElementById('filter-form');
  const ticketItems = document.querySelectorAll('.ticket-item'); // HTMLにすでにあるチケット一覧を取得

  // --- 絞り込み処理 ---
  function applyFilters() {
    // 入力された値を取得
    const startDate = document.getElementById('start-date').value;
    const endDate = document.getElementById('end-date').value;
    const prefecture = document.getElementById('prefecture').value;
    const artist = document.getElementById('artist').value.trim().toLowerCase();

    let visibleCount = 0;

    // HTMLにある各チケット項目をループして、表示/非表示を切り替える
    ticketItems.forEach(item => {
      const itemDate = item.dataset.date;
      const itemPrefecture = item.dataset.prefecture;
      const itemArtists = item.dataset.artists.toLowerCase();

      let isVisible = true;

      // 日付の絞り込み
      if (startDate && itemDate < startDate) isVisible = false;
      if (endDate && itemDate > endDate) isVisible = false;

      // 都道府県の絞り込み
      if (prefecture && itemPrefecture !== prefecture) isVisible = false;

      // 出演者の絞り込み (部分一致)
      if (artist && !itemArtists.includes(artist)) isVisible = false;

      // 表示/非表示を設定
      item.style.display = isVisible ? '' : 'none';
      if(isVisible) visibleCount++;
    });

    // もし1件も表示されなかった場合の処理は、ここに追加できます
  }

  // --- イベントリスナーの設定 ---
  filterForm.addEventListener('submit', function(event) {
    event.preventDefault(); // ページの再読み込みを防ぐ
    applyFilters();
  });

  filterForm.addEventListener('reset', function() {
    // フォームリセット後、すぐに全件表示に戻す
    setTimeout(applyFilters, 0);
  });
</script>